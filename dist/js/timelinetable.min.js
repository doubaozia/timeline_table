"use strict";var _utils={crtElm:function(t,e,a){var i=document.createElement(t);if(e){if("string"==typeof e)return i.className=e,i;for(var n in e)i.key=e[n]}return a&&i.appendChild(a),i},wrapTd:function(t,e,a){var i='<div class="detail hide">'+('<div class="item">'+a+"</div>")+"</div>",n='<i class="tlt-arrow-down"></i>';return t?'<td class="item"><span class="title">'+t+'：</span><span class="value">'+e+"</span>"+n+i+"</td>":'<td class="item">'+e+n+i+"</td>"},wrapDateTd:function(t){return'<td class="item date">'+t.replace(" ","<br>")+"</td>"},wrapTr:function(t){return'<tr class="log-row">'+t+"</tr>"},wrapPage:function(t,e){return'<li class="page '+(e?"active":"")+'"><a>'+t+"</a></li>"},wrapPageNav:function(t,e){var a="";return"prev"===t&&(a="← 前一页"),"next"===t&&(a="后一页 → "),'<li class="'+t+" "+(e?"disabled":"")+'"><a>'+a+"</a></li>"},wrapPageSize:function(t,e){return'<label class="tlt-pagesize-label">每页显示<select>'+e.map(function(e){var a=e===t?"selected":"";return e<0?'<option value="'+e+'" '+a+">全部</option>":'<option value="'+e+'" '+a+">"+e+"</option>"}).join("")+"</select>条</label>"},wrapPageRow:function(t,e,a,i,n){return'<div class="col-lg-4"><div class="tlt-page-info">共'+t+'条记录</div></div><div class="col-lg-8"><div class="tlt-pagination"><ul>'+e+a+i+"</ul></div>"+n+"</div>"}},TimeLineTable=function(t,e){this.container=t,this.tContainer=_utils.crtElm("div","tlt-table-container"),this.table=_utils.crtElm("table","tlt-table"),this.pContainer=_utils.crtElm("div","tlt-page-container"),this.options={};for(var a in TimeLineTable.defaultOptions)this.options[a]=TimeLineTable.defaultOptions[a];for(var a in e)this.options[a]=e[a];e.data?this.data=e.data:console.warn("The second parameter must contain a 'data' property!"),this.pageSize=this.options.pageSizes[0],this.curPage=1,this._init()};TimeLineTable.prototype={constructor:TimeLineTable,_init:function(){this.setup(),this.update()},setup:function(){var t=_utils.crtElm("div","log-list");this.tContainer.appendChild(t),t.appendChild(this.table),this.container.appendChild(this.tContainer),this.container.appendChild(this.pContainer)},update:function(){this.updateTable(),this.updatePaging()},updateTable:function(){var t=this,e="",a=this.options.data,i=this._pageInfo().pageStartIndex,n=this._pageInfo().pageEndIndex,r=this.options.dateField;t.table.querySelector("thead")||t.table.appendChild(_utils.crtElm("thead")),t.table.querySelector("tbody")||t.table.appendChild(_utils.crtElm("tbody"));for(var s=t.table.querySelector("tbody"),l=i;l<n&&a[l];l++){var o="";r&&(o+=_utils.wrapDateTd(a[l][this.options.dateField])),o+=_utils.wrapTd("",a[l].desc,a[l].detail),e+=_utils.wrapTr(o)}s.innerHTML=e},updatePaging:function(){var t,e,a="",i=this._pageInfo().pageSize,n=this._pageInfo().pageCount,r=this._pageInfo().page,s=this._pageInfo().dataCount,l=this._pageInfo().pageStart,o=this._pageInfo().pageEnd,p=_utils.wrapPageSize(i,this.options.pageSizes);t=1===r||0===n?_utils.wrapPageNav("prev",!0):_utils.wrapPageNav("prev",!1),e=r===n||0===n?_utils.wrapPageNav("next",!0):_utils.wrapPageNav("next",!1);for(var c=l;c<=o;c++)a+=r===c?_utils.wrapPage(c,!0):_utils.wrapPage(c,!1);this.pContainer.innerHTML=_utils.wrapPageRow(s,t,a,e,p),this._registerEvent()},destroy:function(){var t=this.table.querySelector("tbody"),e=this.container.querySelector(".p-container");this.table.removeChild(t),this.container.removeChild(e)},_registerEvent:function(){var t=this.container.querySelector(".tlt-pagesize-label select"),e=this.container.querySelector(".tlt-pagination .prev"),a=this.container.querySelector(".tlt-pagination .next"),i=this.container.querySelectorAll(".tlt-pagination .page"),n=this.container.querySelectorAll(".log-row i"),r=this;t.addEventListener("change",function(t){var e=parseInt(t.target.value);r.pageSize=e,r.update()},!1),e.addEventListener("click",function(){1!==r.curPage&&(r.curPage--,r.update())},!1),a.addEventListener("click",function(){var t=r._pageInfo().pageCount;r.curPage!==t&&(r.curPage++,r.update())},!1),i.forEach(function(t){var e=parseInt(t.querySelector("a").innerText);t.addEventListener("click",function(){r.curPage=e,r.update()},!1)}),n.forEach(function(t){t.addEventListener("click",function(){var e=t.parentElement.querySelector(".detail");"tlt-arrow-down"===t.className?(t.className="tlt-arrow-up",e.className="detail"):(t.className="tlt-arrow-down",e.className+=" hide")})})},_pageInfo:function(){var t,e=this.curPage,a=this.pageSize,i=this.data.length,n=Math.ceil(i/a),r=this.options.showPages;t=e<=Math.ceil(r/2)?1:e>=n-Math.floor(r/2)?n-r+1:e-Math.floor(r/2);var s,l,o=Math.min(t+r-1,n);return-1===a?(s=1,l=i):(s=a*(e-1),l=a*e),{page:e,pageSize:a,pageCount:n,dataCount:i,showPages:r,pageStart:t,pageEnd:o,pageStartIndex:s,pageEndIndex:l}}},TimeLineTable.defaultOptions={dateField:"date",datePosition:"left",pageSizes:[10,20,30,-1],showPages:5,showTotal:!0,showPageSize:!0};